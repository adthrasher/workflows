- name: quickcheck_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task quickcheck tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam"
  files:
    - path: test-output/out/checked_bam/test.bam

- name: split_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task split tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam"
  files:
    - path: test-output/out/split_bams/0/
    - path: test-output/out/split_bams/1/

- name: flagstat_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task flagstat tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam"
  files:
    - path: test-output/out/flagstat_report/test.flagstat.txt

- name: index_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task index tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam"
  files:
    - path: test-output/out/bam_index/test.bam.bai
  
- name: subsample_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task subsample tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam" desired_reads=100
  files:
    - path: test-output/out/sampled_bam/test.subsampled.bam

- name: merge_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task merge -i tests/tools/input_json/samtools_merge.json tools/samtools.wdl
  files:
    - path: test-output/out/merged_bam/test.bam

- name: addreplacerg_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task addreplacerg tools/samtools.wdl bam="tests/tools/input/test.bwa_aln_pe.bam" read_group_id="test"
  files:
    - path: test-output/out/tagged_bam/test.bwa_aln_pe.read_group.bam

- name: collate_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task collate tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam"
  files:
    - path: test-output/out/collated_bam/test.collated.bam

- name: bam_to_fastq_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task bam_to_fastq tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam"
  files:
    - path: test-output/out/read_one_fastq_gz/test_R1.fastq.gz
    - path: test-output/out/read_two_fastq_gz/test_R2.fastq.gz

- name: collate_to_fastq_miniwdl
  tags:
    - miniwdl
    - samtools
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task collate_to_fastq tools/samtools.wdl bam="https://github.com/stjude/CICERO/raw/master/test/data/input/test.bam" store_collated_bam=true
  files:
    - path: test-output/out/collated_bam/test.collated.bam
    - path: test-output/out/read_one_fastq_gz/test_R1.fastq.gz
    - path: test-output/out/read_two_fastq_gz/test_R2.fastq.gz