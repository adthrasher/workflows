- name: mark_duplicates_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task mark_duplicates tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam" memory_gb=16
  files:
    - path: test-output/out/duplicate_marked_bam/test.bwa_aln_pe.MarkDuplicates.bam
    - path: test-output/out/duplicate_marked_bam_index/test.bwa_aln_pe.MarkDuplicates.bam.bai
    - path: test-output/out/duplicate_marked_bam_md5/test.bwa_aln_pe.MarkDuplicates.bam.md5
    - path: test-output/out/mark_duplicates_metrics/test.bwa_aln_pe.MarkDuplicates.metrics.txt

- name: validate_bam_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task validate_bam tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam"
  files:
    - path: test-output/out/validated_bam/test.bwa_aln_pe.bam
    - path: test-output/out/validate_report/test.bwa_aln_pe.ValidateSamFile.txt

- name: bam_to_fastq_picard_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task bam_to_fastq tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam"
  files:
    - path: test-output/out/read_one_fastq_gz/test.bwa_aln_pe_R1.fastq.gz
    - path: test-output/out/read_two_fastq_gz/test.bwa_aln_pe_R2.fastq.gz

- name: sort_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task sort tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam" memory_gb=16
  files:
    - path: test-output/out/sorted_bam/test.bwa_aln_pe.sorted.bam

# TODO: merge_sam_files

- name: clean_sam_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task clean_sam tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam"
  files:
    - path: test-output/out/cleaned_bam/test.bwa_aln_pe.cleaned.bam

# TODO: collect_wgs_metrics
- name: collect_wgs_metrics_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task collect_wgs_metrics tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam" reference_fasta="tests/tools/input/GRCh38.chrY_chrM.fa.gz"
  files:
    - path: test-output/out/wgs_metrics/test.bwa_aln_pe.CollectWgsMetrics.txt

- name: collect_alignment_summary_metrics_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task collect_alignment_summary_metrics tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam"
  files:
    - path: test-output/out/alignment_metrics/test.bwa_aln_pe.CollectAlignmentSummaryMetrics.txt
    - path: test-output/out/alignment_metrics_pdf/test.bwa_aln_pe.CollectAlignmentSummaryMetrics.pdf

- name: collect_gc_bias_metrics_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task collect_gc_bias_metrics tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam" reference_fasta=tests/tools/input/GRCh38.chrY_chrM.fa.gz
  files:
    - path: test-output/out/gc_bias_metrics/test.bwa_aln_pe.CollectGcBiasMetrics.txt
    - path: test-output/out/gc_bias_metrics_summary/test.bwa_aln_pe.CollectGcBiasMetrics.summary.txt
    - path: test-output/out/gc_bias_metrics_pdf/test.bwa_aln_pe.CollectGcBiasMetrics.pdf

- name: collect_insert_size_metrics_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task collect_insert_size_metrics tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam"
  files:
    - path: test-output/out/insert_size_metrics/test.bwa_aln_pe.CollectInsertSizeMetrics.txt
    - path: test-output/out/insert_size_metrics_pdf/test.bwa_aln_pe.CollectInsertSizeMetrics.pdf

- name: quality_score_distribution_miniwdl
  tags:
    - miniwdl
    - picard
  command: >-
    miniwdl run -d test-output/. --copy-input-files --task quality_score_distribution tools/picard.wdl bam="tests/tools/input/test.bwa_aln_pe.bam"
  files:
    - path: test-output/out/quality_score_distribution_txt/test.bwa_aln_pe.QualityScoreDistribution.txt
    - path: test-output/out/quality_score_distribution_pdf/test.bwa_aln_pe.QualityScoreDistribution.pdf